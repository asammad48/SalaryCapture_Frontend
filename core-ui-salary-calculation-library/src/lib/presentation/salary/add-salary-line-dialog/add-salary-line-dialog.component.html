<div class="p-dialog-body pt-0 px-0 mb-0 mt-0">

  <salary-calculation-portal-progress-loading loaderKey="SalaryCapture_AddSalaryLine"></salary-calculation-portal-progress-loading>

  <div *ngIf="showConflictError || showConflictWarning">
    <lib-warning-banner
      severity="error"
      [show]="showConflictError"
      [title]="'Conflict Detected'"
      [message]="conflictErrorMessage">
    </lib-warning-banner>
  
    <lib-warning-banner
      severity="warning"
      [show]="showConflictWarning"
      [title]="'Conflict Detected'"
      [message]="conflictWarningMessage">
    </lib-warning-banner>
  </div>

  <div class="d-flex min-h-31">

    <div [ngClass]="isTimelineInformationControl || isTimeDistanceControl
                ? 'w-50 border-end border-gray-300'
                : 'w-100'" class="pt-3">
      <form [formGroup]="addSalaryLineForm">
        <div class="px-20">
          <div class="mb-3 d-flex flex-column">
            <label class="form-label">Select Date <span class="text-danger">*</span> </label>
            <!-- <p-datepicker #salaryLinedatePicker id="salary-line-date" formControlName="productionDate" [showIcon]="true"
              [iconDisplay]="'input'" [minDate]="getProductionDateMinConstraint()"
              [maxDate]="getProductionDateMaxConstraint()" appendTo="body" styleClass="w-100" placeholder="Select date"
              dateFormat="dd-mm-yy" /> -->

              <p-datepicker styleClass="w-100 wrapper-focus datepicker-dropdown-bg-white" [showIcon]="true" inputId="buttondisplay" [showOnFocus]="showDatePikcerOnFocus" 
              inputStyleClass="border-end-0" #salaryLinedatePicker id="salary-line-date" formControlName="productionDate"
              [minDate]="getProductionDateMinConstraint()" [maxDate]="getProductionDateMaxConstraint()" (onFocus)="onDatepickerFocus($event)"  (onShow)="onCalendarShow()"  (onHide)="onCalendarHide()"
              appendTo="body" placeholder="Select date" panelStyleClass="width-29"
              dateFormat="dd-mm-yy"/>

            <div class="invalid-feedback d-block"
              *ngIf="addSalaryLineForm.controls['productionDate'].touched && addSalaryLineForm.controls['productionDate'].hasError('required')">
              <span>Date is required</span>
            </div>
          </div>

          <div class="mb-3 d-flex flex-column">
            <label class="form-label">Service Worker(s) <span class="text-danger">*</span> </label>
            <p-multiSelect id="salary-line-worker" dataKey="id" [virtualScroll]="true" showClear="true" [loading]="isLoadingServiceWorkers"
              [options]="apiWorkers" [virtualScrollItemSize]="38" appendTo="body"
              panelStyleClass="bg-select-header-gray-200" formControlName="serviceWorkers" optionLabel="displayName"
              placeholder="Select service workers" [filter]="true" [showToggleAll]="true"
              styleClass="w-100" [maxSelectedLabels]="3" selectedItemsLabel="{0} workers selected" (onPanelShow)="handlefocusMultiItems()">
            </p-multiSelect>

            <div class="invalid-feedback d-block"
              *ngIf="addSalaryLineForm.controls['serviceWorkers'].touched && addSalaryLineForm.controls['serviceWorkers'].hasError('required')">
              <span>At least one service worker is required</span>
            </div>
          </div>
        </div>
        <!-- <hr class="border-gray-500"> -->

        <div class="px-20">

          <div class="mb-3">
            <label class="form-label">Job</label>
            <input type="text" class="form-control" formControlName="jobNumber" placeholder="Enter job" id="salary-line-job" />
          </div>

          <div class="mb-3 d-flex flex-column">

            <label class="form-label">Salary Line <span class="text-danger">*</span> </label>

            <p-select id="salary-line-transaction" [options]="salaryCodes" appendTo="body" styleClass="w-100"
              formControlName="salaryCode" optionLabel="salaryCode" [filter]="true" dataKey="salaryCodeId" (onShow)="unfocusDropdownItems()"
              placeholder="Select salary line">
            </p-select>

            <div class="invalid-feedback d-block"
              *ngIf="addSalaryLineForm.controls['salaryCode'].touched && addSalaryLineForm.controls['salaryCode'].hasError('required')">
              <span>Salary line is required</span>
            </div>

          </div>

        </div>

        <div class="px-20">

          <div class="mb-3">
            <label class="form-label">Description</label>
            <p>{{ currentDescription }}</p>
          </div>

          <div class="mb-3 d-flex flex-column">

            <label class="form-label">{{ currentQuarterLabel }} <span class="text-danger">*</span></label>

            <p-inputNumber formControlName="quarter" incrementButtonClass="pt-1" decrementButtonClass="pb-1" id="salary-line-value"   [useGrouping]="false"
              [showButtons]="true" [placeholder]="currentQuarterPlaceholder" styleClass="w-100">
            </p-inputNumber>

            <div class="invalid-feedback d-block"
              *ngIf="addSalaryLineForm.controls['quarter'].touched && addSalaryLineForm.controls['quarter'].invalid">
              <span *ngIf="addSalaryLineForm.controls['quarter'].hasError('required')">{{ currentQuarterLabel }} is
                required</span>
            </div>

            <div class="invalid-feedback d-block"
              *ngIf="addSalaryLineForm.controls['quarter'].touched && addSalaryLineForm.controls['quarter'].hasError('max')">
              <span>{{ currentQuarterLabel }} cannot be more than {{ currencyMaxValue }}</span>
            </div>

            <div class="invalid-feedback d-block"
              *ngIf="addSalaryLineForm.controls['quarter'].touched && addSalaryLineForm.controls['quarter'].hasError('min')">
              <span>{{ currentQuarterLabel }} cannot be less than {{ currencyMinValue }}</span>
            </div>

          </div>

        </div>
      </form>
    </div>

    <div class="w-50 pt-3" *ngIf="isTimelineInformationControl || isTimeDistanceControl">
      <ng-container *ngIf="isTimelineInformationControl">
        <lib-salary-line-timeline-info [addSalaryLineForm]="addSalaryLineForm" [salaryLine]="salaryLine" [salaryLineDialogConfig]="salaryLineDialogConfig"
          [isEditMode]="isEditMode" [timelineStartTime]="timelineStartTime" (onTimelineChange)="onTimelineChange()"
          [timelineEndTime]="timelineEndTime">
        </lib-salary-line-timeline-info>
      </ng-container>

      <ng-container *ngIf="isTimeDistanceControl">
        <lib-salary-line-address-info [addSalaryLineForm]="addSalaryLineForm" [salaryLine]="salaryLine"
          [isEditMode]="isEditMode">
        </lib-salary-line-address-info>
      </ng-container>
    </div>
  </div>
</div>

<div class="p-dialog-footer border-top-0 px-0">
  <button type="button" class="btn btn-sm color-gray-600 btn-tabindex-focus" (click)="closeModal(false)" id="cancel-add-salary-line-btn">
    Cancel </button>
  <button type="button" class="btn btn-primary btn-sm me-0" (click)="submitSalaryLine()" [disabled]="isSaveDisabled()" id="save-add-salary-line-btn">
    Save </button>
</div>

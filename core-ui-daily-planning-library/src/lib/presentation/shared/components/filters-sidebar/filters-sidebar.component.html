<div class="card border-gray-200 max-w-18 transition-ease-in-1s rounded-6"
  [ngClass]=" filterPanelCollapsed ? 'width-4' : 'min-w-18'">
  <div
    class="card-header bg-white border-bottom-2 border-gray-300 d-flex align-items-center height-px-70 justify-content-between"
    [ngClass]=" filterPanelCollapsed ? 'justify-content-center' : 'ps-3 justify-content-between'">
    <div [ngClass]=" filterPanelCollapsed ? 'd-none' : 'd-block'">
      <h6 class="fw-bold m-0">Daily Planning System</h6>
    </div>
    <span [title]="filterPanelCollapsed ? 'Open Panel':'Close Panel'" id="capture-filter-toggler"
      class="cursor-pointer focus-visible rounded-2" (click)="filterPanelToggler()"
      (keydown.enter)="filterPanelToggler()" tabindex="0" #filterToggler>
      <svg class="width-px-24 height-px-24 fill-600 hover-fill-gray-700">
        <use [attr.xlink:href]="filterPanelCollapsed ? '#left-panel-open' : '#left-panel-close'">
        </use>
      </svg>
    </span>
  </div>
  <div class="card-body overflow-auto px-3 py-3" [ngClass]="!filterPanelCollapsed && planningMode === PlanningMode.DailyPlan && totalRecords > 0 ? 'vh-278'
    : !filterPanelCollapsed ? 'vh-233' : 'vh-164'">

    <span class="fa-rotate-270 mt-px-156 fw-bold fs-16 text-nowrap" [ngClass]=" filterPanelCollapsed ? 'd-block' : 'd-none'">Daily Planning System</span>

    <form [ngClass]=" filterPanelCollapsed ? 'd-none' : 'd-block'">

      <div class="mb-3 d-flex flex-column">

        <label class="form-label">Depo</label>

        <p-treeSelect
          [(ngModel)]="selectedDepot"
          [options]="organizationTree"
          name="depot"
          placeholder="Select a depo"
          class="w-100"
          containerStyleClass="w-100"
          panelStyleClass="width-16"
          [filter]="true"
          filterPlaceholder="Search..."
          [loading]="isLoadingTree"
          selectionMode="single"
          [propagateSelectionDown]="false"
          [propagateSelectionUp]="false"
          (onNodeExpand)="onNodeExpand($event)"
          (onNodeCollapse)="onNodeCollapse($event)"
          (onNodeSelect)="onDepotSelect($event)"
          (onShow)="onPanelShow()"
          appendTo="body">
        </p-treeSelect>

      </div>

      <!-- Day of Week Selection for Base Plan -->
      <div class="mb-3" *ngIf="planningMode === PlanningMode.BasePlan">
        <label class="form-label">Day of the Week</label>
        <div class="d-flex flex-wrap row-gap-2 mt-1 mb-3">
          @for (day of daysOfWeek; track $index; let i = $index) {
          <div class="w-33-3" [ngClass]="{ 'pe-2': !((i + 1) % 3 === 0)}">
            <input type="radio" class="btn-check" name="daysOfWeek" [value]="day.value" [id]="'daysOfWeek' + (i+1)"
              autocomplete="off" (change)="onDaySelect(day.value)" />
            <label class="btn btn-sm btn-outline-primary fw-normal border border-gray-400 w-100 hover-gray-100"
              [for]="'daysOfWeek' + (i+1)"
              [ngClass]="[selectedDay === day.value ? 'btn-primary text-white' : 'color-gray-900']">
              {{ day.label }}
            </label>
          </div>
          }
        </div>
      </div>

      <!-- Date Selection for Daily Plan -->
      <div class="mb-3 d-flex flex-column" *ngIf="planningMode === PlanningMode.DailyPlan">
        <label class="form-label">Date</label>
        <p-datepicker
          [(ngModel)]="selectedDate"
          [showIcon]="true"
          [iconDisplay]="'input'"
          inputStyleClass="pe-28 fs-15"
          appendTo="body"
          styleClass="w-100"
          panelStyleClass="z-index-1"
          placeholder="Select date"
          dateFormat="dd-mm-yy"
          (onSelect)="onDateSelect($event)"
          name="selectedDate"
          id="daily-plan-date-select">
        </p-datepicker>
      </div>

      <label class="form-label mb-0">Status</label>
      <div class="mt-2">
        @for (s of statusList; track $index) {
        <div class="form-check ps-0 mb-2">
          <input class="form-check-input" type="radio" name="statusRadios" [value]="s.value"
            [checked]="selectedStatus === s.value" [id]="'status' + ($index + 1)" (change)="onSelectStatus(s.value)" />
          <label class="form-check-label" [for]="'status' + ($index + 1)">
            {{ s.label }}
          </label>
        </div>
        }
      </div>
    </form>

  </div>

  <div class="card-footer bg-white border-gray-300 p-3" [ngClass]=" filterPanelCollapsed ? 'd-none' : 'd-block'">
    <button type="button" class="btn btn-sm btn-primary w-100" pButton pRipple
      [ngClass]="filterPanelCollapsed ? 'd-none' : 'd-block'" id="capture-applyfilter-btn"
      (click)="applyFilters()">
      Apply Filters
    </button>
    <button
      *ngIf="showResetButton()"
      type="button" 
      class="btn btn-sm btn-outline-secondary w-100 mt-2" 
      pButton 
      pRipple
      [ngClass]=" (planningMode === PlanningMode.DailyPlan && !filterPanelCollapsed) ? 'd-block' : 'd-none'" 
      id="capture-resetfilter-btn"
      (click)="resetDailyPlan()">
      Reset Daily Plan
    </button>
    <button
      *ngIf="showEditDailyPlanButton()"
      type="button" 
      class="btn btn-sm btn-outline-secondary w-100 mt-2" 
      pButton 
      pRipple
      [ngClass]=" (planningMode === PlanningMode.DailyPlan && !filterPanelCollapsed) ? 'd-block' : 'd-none'" 
      id="capture-edit-dailyplan-btn"
      (click)="createDailyPlan()">
      Edit Daily Plan
    </button>
  </div>

</div>

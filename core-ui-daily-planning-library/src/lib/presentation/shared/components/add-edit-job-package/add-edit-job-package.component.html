<form [formGroup]="jobPackageForm">

    <dp-progress-loading loaderKey="Add_Edit_JobPackage"></dp-progress-loading>


    <div class="p-dialog-body my-0 py-20">

        <div class="w-100">

            <!-- Name Field -->
            <div class="mb-3">
                <label for="jobPackageName" class="form-label text-capitalize">
                    Name <span class="text-danger">*</span>
                </label>
                <input
                    id="jobPackageName"
                    formControlName="name"
                    placeholder="Enter job package name"
                    class="form-control"
                    [class.is-invalid]="nameControl?.invalid && nameControl?.touched"
                />
                <div class="invalid-feedback" *ngIf="nameControl?.invalid && nameControl?.touched">
                    <small *ngIf="nameControl?.errors?.['required']">Name is required</small>
                    <small *ngIf="!nameControl?.errors?.['required'] && nameControl?.errors?.['whitespace']">Name cannot be empty</small>
                </div>
            </div>

            <!-- Organization Unit Field -->
            <div class="mb-3">
                <label for="jobPackageOrganizationUnit" class="form-label">
                    Depo <span class="text-danger">*</span>
                </label>
                <p-treeselect
                    [filter]="true"
                    id="jobPackageOrganizationUnit"
                    styleClass="w-100"
                    containerStyleClass="w-100"
                    [options]="organizationTree"
                    formControlName="organizationUnitId"
                    placeholder="Select a depo"
                    [loading]="isLoadingOrganizationTree"
                    appendTo="body"
                    (onNodeExpand)="onNodeExpand($event)"
                    (onNodeCollapse)="onNodeCollapse($event)"
                    [class.is-invalid]="organizationUnitIdControl?.invalid && organizationUnitIdControl?.touched">
                </p-treeselect>
                <div class="text-danger mt-1" *ngIf="organizationUnitIdControl?.invalid && organizationUnitIdControl?.touched">
                    <small *ngIf="organizationUnitIdControl?.errors?.['required']">Organization unit is required</small>
                </div>
            </div>

            <!-- Days of the Week - Only show in BasePlan mode -->
            <div *ngIf="isBasePlan">
                <label class="form-label mb-0">
                    Days of the Week <span class="text-danger">*</span>
                </label>
                <div class="d-flex flex-wrap row-gap-2 mt-2 mb-3" formArrayName="daysOfWeek">
                    <div class="pe-2 w-20" *ngFor="let day of daysOfWeek">
                        <label
                            class="d-flex align-items-center gap-2 border border-gray-400 fw-normal p-2 rounded-px-5 text-secondary fs-14 cursor-pointer"
                            [class.border-primary]="isDaySelected(day.value)"
                            [for]="day.value">
                            <p-checkbox
                                [name]="'daysOfWeek'"
                                [value]="day.value"
                                [inputId]="day.value"
                                [binary]="true"
                                [ngModel]="isDaySelected(day.value)"
                                [ngModelOptions]="{standalone: true}"
                                (onChange)="onDayChange($event, day.value)">
                            </p-checkbox>
                            <label [for]="day.value" class="mb-0 cursor-pointer">{{ day.shortLabel }}</label>
                        </label>
                    </div>
                </div>
                <div class="text-danger" *ngIf="daysOfWeekControl?.invalid && daysOfWeekControl?.touched">
                    <small *ngIf="daysOfWeekControl?.errors?.['required']">At least one day must be selected</small>
                    <small *ngIf="!daysOfWeekControl?.errors?.['required'] && daysOfWeekControl?.errors?.['minArrayLength']">At least one day must be selected</small>
                </div>
            </div>

            <!-- Tags Field -->
            <div class="form-group">
                <label class="form-label">Tags</label>
                <div>
                    <p-autocomplete
                    multiple
                    [suggestions]="[]"
                    placeholder="Enter tags..."
                    formControlName="tags"
                    [typeahead]="false" 
                    styleClass="chip-fs-12 icon-width-13 w-100 chip-icon-mt-n4 autocomplete-p-form-field p-chip-text-truncate">
                    </p-autocomplete>
                </div>
            </div>


        </div>
    </div>

    <!-- Dialog Footer -->
    <div class="p-dialog-footer">
        <button
            type="button"
            class="btn btn-sm color-gray-600 focus-visible me-2"
            (click)="cancel()">
            Cancel
        </button>
        <button
            type="button"
            class="btn btn-primary btn-sm me-0"
            [disabled]="!isFormValid"
            (click)="closeModal(true)">
            Save
        </button>
    </div>
</form>